<cfcomponent name="user"			 extends="baseHandler"			 output="false"			 hint="Our main handler for user interactivity."			 autowire="true"			 cache="true" cacheTimeout="0"><!------------------------------------------- PUBLIC ------------------------------------------->	<cffunction name="login" access="public" returntype="void" output="false">		<cfargument name="Event" type="coldbox.system.beans.requestContext">		<cfscript>			var rc = event.getCollection();			/* Right login view */			event.setView("users/login");		</cfscript>	</cffunction>	<cffunction name="doLogin" access="public" returntype="void" output="false">		<cfargument name="Event" type="coldbox.system.beans.requestContext">		<cfscript>			var rc = event.getCollection();			var oUser = "";			var refRoute = getPlugin("Utilities").ripExtension(event.getValue("refRoute",""));			/* Validate */			if( not trim(event.getValue('username','')).length() or			 	not trim(event.getValue('password','')).length() ){				/* Invalid Login */				getPlugin("messagebox").setMessage("warning", "Please enter all the required fields to log in.");				/* relocate to invalid route */				setNextRoute(route="user/login");			}		</cfscript>		<!--- Validate Login --->		<cfif getSecurityService().authenticateUser(rc.username,rc.password)>			<!--- Login Stuff, only executes for logged in users ONCE. --->			<cflogin>				<cfset oUser = getSecurityService().getUserSession()>				<!--- Check if Authorized to login once --->				<cfif oUser.getisAuthorized()>					<cfloginuser name="#oUser.getUsername()#"								 password="#oUser.getPassword()#"								 roles="#oUser.getRole().getRole()#" />				</cfif>			</cflogin>			<!--- Relocate Now --->			<cfset setNextRoute(refRoute)>		<cfelse>			<cfset getPlugin("messagebox").setMessage("error", "The credentials you provided are not valid or your user is not active. Please try again.")>			<cfset setNextRoute(route="user/login")>		</cfif>	</cffunction>	<cffunction name="logout" access="public" returntype="void" output="false">		<cfargument name="Event" type="coldbox.system.beans.requestContext">		<cfset getSecurityService().cleanUserSession()>		<cflogout>		<cfset setNextRoute(route="index")>	</cffunction>	<cffunction name="passwordReminder" access="public" returntype="void" output="false">		<cfargument name="Event" type="coldbox.system.beans.requestContext">		<cfscript>		</cfscript>	</cffunction>	<cffunction name="doPasswordReminder" access="public" returntype="void" output="false">		<cfargument name="Event" type="coldbox.system.beans.requestContext">		<cfscript>		</cfscript>	</cffunction>	<!--- set the security service --->
	<cffunction name="setSecurityService" access="public" returntype="void" output="false">		<cfargument name="SecurityService" type="codex.model.security.SecurityService" required="true">		<cfset instance.SecurityService = arguments.SecurityService>	</cffunction>
<!------------------------------------------- PACKAGE ------------------------------------------->

<!------------------------------------------- PRIVATE ------------------------------------------->
	<!--- Get the security service --->	<cffunction name="getSecurityService" access="private" returntype="codex.model.security.SecurityService" output="false">
		<cfreturn instance.SecurityService>
	</cffunction></cfcomponent>